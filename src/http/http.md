https://feisky.gitbooks.io/sdn/content/basic/tcpip.html
https://www.cnblogs.com/imyalost/p/5629606.html
1.http、https 2.强缓存与协商缓存
3.url

TCP/IP

- 1.链路层 封装、解封装 IP 报文，发送和接受 ARP/PARP 报文，将二进制数据包与网络信号相互之间转换
- 2.网络层 路由以及分组报文发送给目标网络或主机 ipv4 - 2^32 ipv6 - 2^128
- - 1.ip 是不可靠的无连接协议，它并不关心数据包是否到达目的地，也不关心连接和端口号，目的连接目标 IP
- - 2.它的工作是发送数据包并将其路由到目标计算机，其中每个数据包都是独立的互不依赖的，所以有可能会乱序到达目标地址或者在传输途中丢失，那如何保证数据包到达和顺序正确呢，这都交给了 tcp，体现了分层的作用，
- - 3.当数据包过大时，在 ip 层会进行分包，由于每个数据包在物理链路层走的物理链路不一样，传输速度也不一样，导致数据包没有按顺序到达目的地，但 tcp 会根据数据包上携带的序列号来进行排序重组
- - 4.发送方在一个特定时间内，没有接收到接受方的 ack 确认时，则发送方会重新发送该数据包 ip 不等于 IP 地址
- 3.传输层 对报文进行分组和重组，并以 TCP 或 UDP 协议格式封装报文 ，发送数据包到计算机使用特定端口号的应用程序
- 4.应用层 向用户提供应用程序协议，比如 HTTP、FTP、Telnet、DNS

TCP 面向连接、可靠的数据传输(三次握手)

OSI 七层模型 7.应用层 6.表示层 5.会话层 4.传输层 3.网络层 2.数据链路层 1.物理层

无状态：http 协议是一种自身不对 请求和响应之间的通信状态进行保存的协议，即无状态协议
后来有 cookie

持久性：发送 http 请求，都需要建立 TCP 的连接，再发送报文
http 有一个 connection 属性，用于指定连接的方式
当设置成 keep-alive，http 就会建立一条持久化的连接，不需要每次都建立连接，再中断

管线化：使得 http 请求比持久性连接更要快；特点：请求数越多，时间差越明显

内容编码：为了减少传输时间，会采取一些压缩的措施
Accept-Encoding 定义内容编码的格式：gzip
gzip：Gun 压缩格式
compress：UNIX 系统的标准压缩格式
deflate：使用 LZ77 和哈弗曼的无损压缩格式
identity：不进行压缩

多部分对象集合：传输时不仅是一些字符串，还有可能是图片，字符串，二进制
例如在使用 java 编写 web 上传文件的代码时，需要在 form 中指定 form 的编码格式
multipart
设置 form 的 enctype 属性的值为 multipart/form-data
默认情况下 form 使用的编码格式是：application/x-www-form-urlencoded

范围请求：http 报文请求一些很大图片，加载过程很慢
有时候图片是一快一块加载的。因为设置了 http 请求的长度，这样可以分块加载资源文件
在请求报文中使用 Range 属性，响应体报文中使用 Content-Type 属性也可以指定一定字节范围

http 协议的数据传输方式
GET 和 POST
区别：
目标不同：get 方法只是用来查询，不会对浏览器上的信息产生影响
大小不同：get 放在 URL 首部，随浏览器而定，post 在报文中，只要没具体限制，文件的大小是没限制的
安全性：get 明文传输，post 放在报文中

关于三次握手，我是这样理解的，前面的随笔有说到通信过程，
三次握手基于 http 协议的四个层次，从应用层到网络层。层层打
上标签，然后到达服务端的过程中又层层解封，返回响应也是
这样，这是简单的一个通信过程，也是数据包封装发送的过程，
这篇随笔我没有详细解释，可能是因为之前觉得已经写过这些
内容了，

多路复用 代替原来的序列和阻塞机制，所有就是请求的都是通过一个 TCP 连接并发完成
同时也很好的解决了浏览器限制同一个域名下的请求数量的问题
http2 有了二进制分帧之后，http2 不再依赖 TCP 链接去实现多流并行了：

1.同域名下所有通信都在单个连接上完成，同一域名只需要占一个 TCP 连接，使用一个连接并行发送多个请求和响应 2.单个连接可以承载任意数量的双向数据流，单个连接上可以并行交错的请求和响应

帧：数据传输的最小单位，每个帧都会标识出该帧属于哪个流，流也就是多个帧组成的数据流
流：存在与连接中的一个虚拟通道

http2 采用二进制数据帧传输，取代了 http1.x 的文本格式，二进制格式解析更高效

多路复用是对同一域名下所有请求都是基于流，所以不存在同域并行的阻塞
代替了 http1.x 的序列和阻塞机制，所有相同域名请求都通过同一个 tcp 连接并发完成。同一个 tcp 中可以发送多个请求，对端可以通过帧中的标识知道属于哪个请求。

多个 TCP 连接
没有 keep-alive 值，智能创建多个 TCP 连接来做多次请求

Keep-Alive
解决的核心问题是：一定时间内，同一域名多次请求数据，只建立一次 http 请求，其他请求可复用每一次建立的连接通道，以达到提高请求效率的问题。

存在如下问题：
串行的文件传输
同域并行请求限制带来的阻塞(6-8)个

管线化：http 管线化可以克服同域并行请求限制带来的阻塞，它是建立在持久连接之上，把所有请求一并发给服务器，但是服务器需要按照顺序一个一个响应，而不是等到一个响应回来才能发下一个请求，节省了很多请求到服务器的时间

存在如下问题：
若上一响应迟迟不回，后面的响应都会被阻塞到

http 超文本传输协议 用于传输 html 的超媒体文档的应用层协议
http 是一个基于 TCP/IP 通信协议来传递数据，也通过三次握手，四次挥手

http/0.9 不涉及数据包传输，主要规定了客户端和服务器之间的通信格式

http/1.0 1.任何格式的内容都可以发送。图片、视频、二进制文件 2.除了 GET 还引入 POST 和 HEAD 命令
3.http 请求和回应格式，每次通信都必须包括头信息，用来描述一些元数据 4.状态码、多字符集支持、多部分发送、权限、缓存、内容编码
存在问题：
主要缺点，每个 TCP 连接只能发送一个请求。发送数据完毕，连接就关闭。如果还需请求其他资源，必须在新建一个连接
tcp 连接的新建成本很高，需要客户端和服务器三次握手

http/1.1
长连接：http1.1 支持长连接和请求的流水线处理，在一个 tcp 连接上可以传送多个 http 请求和响应。默认开启 connection:keep-alive
缓存处理：
http1.0 中主要使用 header 里的 if-Modified-Since Expires
http1.1 中 Entity tag、if-none-match
带宽优化以及网络连接的使用：
http1.0 浪费带宽现象、不支持断点续传功能。
http1.1 请求头引入 range 头域，允许只请求资源的某个部分
host 头处理：
http1.0 中认为每台服务器都绑定一个唯一的 ip 地址，请求消息中没有传递主机名。
虚拟主机的发展，一台物理服务器可存在多个虚拟主机，共享一个 ip 地址。
http1.1 请求消息和响应消息都支持 host 头域
存在问题：
允许复用 tcp 连接，同一个 tcp 连接里面，所有的数据通信是按次序进行的。
服务器只有处理完一个回应，才能进行下一个回应。如果前面回应很慢，后面请求排队等着。队头阻塞
http1.x 在传输数据时，所有传输的内容都是明文。客户端和服务端无法验证
http1.x 在使用时，header 携带内容过大，在一定程度上增加传输的成本。
http1.x 支持 keep-alive，使用多了同样会给服务器端带来大量的性能压力。当文件被请求之后还保持不必要的连接很长时间

SPDY 协议 谷歌自行研发 主要解决 http1.1 效率不高问题
降低延迟，针对 http 高延迟问题，SPDY 优雅采取了多路复用。通过多个请求 stream 共享一个 tcp 连接的方式，解决了 HOL blocking 的问题，降低了延迟同时提高带宽的利用率
请求优先级：多路复用新问题，连接共享的基础之上有可能会导致关键请求被阻塞。
SPDY 允许给每个 request 设置优先级，这样重要请求会优先得到响应
header 压缩
基于 https 的加密协议传输，提高传输数据的可靠性
服务器推送

HTTP => SPDY => SSL => TCP

http2 SPDY 升级版 1.支持明文 http 传输，而 SPDY 强制使用 https 2.消息头的压缩算法采用 HPACK，SPDY 采用 deflate

帧 客户端与服务器通过交换帧来通信
消息 http 消息，比如请求、响应，由一或多个帧组成
流 连接中的一个虚拟信道，承载双向的消息

数据流 => 消息的形式发送 => 消息由一或多个帧组成。帧是流中的数据单位

多路复用 允许同时通过单一的 http/2 连接发起多重的请求-响应消息。即连接共享
请求优先级
header 压缩
http2 使用 encoder 来减少需要传输的 header 大小，通讯双方各自 cache 一份 header fields 表

物理知识
ISP 互联网服务提供商(电信、移动、联通)

- local ISP 互联网服务提供商
- regional ISP 经过多个主干网
- NSP 网络服务提供商 大型网络
- NAP 网络访问点
  ISP NSP 所有网络提供携带路由器，每个路由有当前子网络 IP 的路由表，
  当底层向上层发送数据的时候，找不到会依次向上找，可能由一个主干网络跳到另外一个主干网络
  DNS 服务 分布式数据库，存储了域名和 IP 的对应关系
